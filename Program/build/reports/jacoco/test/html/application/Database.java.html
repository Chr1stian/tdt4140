<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="nb"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Database.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Program</a> &gt; <a href="index.source.html" class="el_package">application</a> &gt; <span class="el_source">Database.java</span></div><h1>Database.java</h1><pre class="source lang-java linenums">package application;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

public class Database {
<span class="fc" id="L14">	private static String mysqlAddr = &quot;jdbc:mysql://sql11.freemysqlhosting.net:3306/sql11164632?allowMultiQueries=true&quot;;</span>
<span class="fc" id="L15">    private static String mysqlUser = &quot;sql11164632&quot;;</span>
<span class="fc" id="L16">    private static String mysqlPass = &quot;JKb6SqBp59&quot;;</span>
	//private static String mysqlAddr = &quot;jdbc:mysql://mysql.stud.ntnu.no:3306/prodoteam_testdb?allowMultiQueries=true&quot;;
    //private static String mysqlUser = &quot;jonaseth_tdt4140&quot;;
    //private static String mysqlPass = &quot;tdt4140&quot;;
    
    @SuppressWarnings(&quot;static-access&quot;)
<span class="fc" id="L22">	public Database(String adr, String user, String password){</span>
<span class="fc" id="L23">    	this.mysqlAddr = adr;</span>
<span class="fc" id="L24">    	this.mysqlUser = user;</span>
<span class="fc" id="L25">    	this.mysqlPass = password;</span>
<span class="fc" id="L26">    }</span>
    
    // ------------SIDEBAR------------
    
    // Finds all topics from a given lecture (lectureID)
    public static ObservableList&lt;Topic&gt; topics(String lectureID){
<span class="fc" id="L32">    	ObservableList&lt;Topic&gt; topicList = FXCollections.observableArrayList();</span>
<span class="pc bpc" id="L33" title="1 of 2 branches missed.">    	if(lectureID == &quot;empty&quot;){</span>
<span class="nc" id="L34">    		return topicList;</span>
    	}
    	try{
<span class="fc" id="L37">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L38">            PreparedStatement stmt = conn.prepareStatement(&quot;SELECT * FROM topic WHERE lectureID = &quot; + lectureID);</span>

<span class="fc" id="L40">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L41" title="All 2 branches covered.">            while(rs.next()){</span>
<span class="fc" id="L42">            	ArrayList&lt;String&gt; topic = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L43" title="All 2 branches covered.">            	for(int i = 1; i &lt; 5; i++){</span>
<span class="fc" id="L44">            		topic.add(rs.getString(i));</span>
<span class="fc" id="L45">            	}topicList.add(new Topic(topic.get(0), topic.get(1), topic.get(2), topic.get(3)));</span>
<span class="fc" id="L46">            }</span>
<span class="fc" id="L47">            conn.close();</span>
<span class="fc" id="L48">            return topicList;</span>
        }
<span class="nc" id="L50">        catch(SQLException e){</span>
<span class="nc" id="L51">            return null;</span>
        }
    }
    
    // Finds all lectures from a given course (courseID)
    public static ObservableList&lt;Lecture&gt; lectures(String courseID){
<span class="fc" id="L57">    	ObservableList&lt;Lecture&gt; lectureList = FXCollections.observableArrayList();</span>
    	try{
<span class="fc" id="L59">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L60">            PreparedStatement stmt = conn.prepareStatement(&quot;SELECT * FROM lecture WHERE courseID = &quot; + courseID);</span>

<span class="fc" id="L62">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">            while(rs.next()){</span>
<span class="fc" id="L64">            	ArrayList&lt;String&gt; lecture = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">            	for(int i = 1; i &lt; 5; i++){</span>
<span class="fc" id="L66">            		lecture.add(rs.getString(i));</span>
<span class="fc" id="L67">            	}lectureList.add(new Lecture(lecture.get(0), lecture.get(1), lecture.get(2), lecture.get(3)));</span>
<span class="fc" id="L68">            }</span>
<span class="fc" id="L69">            conn.close();</span>
<span class="fc" id="L70">            return lectureList;</span>
        }
<span class="nc" id="L72">        catch(SQLException e){</span>
<span class="nc" id="L73">        	System.out.println(e);</span>
<span class="nc" id="L74">            return null;</span>
        }
    }
    
    // Finds all courses from the database
    public static ObservableList&lt;Course&gt; courses(){
    	// Makes a new observable list
<span class="fc" id="L81">    	ObservableList&lt;Course&gt; courseList = FXCollections.observableArrayList();</span>
    	try{
<span class="fc" id="L83">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L84">            PreparedStatement stmt = conn.prepareStatement(&quot;SELECT * FROM course&quot;);</span>
            
            //
<span class="fc" id="L87">            ResultSet rs = stmt.executeQuery();</span>
            
            // While the
<span class="fc bfc" id="L90" title="All 2 branches covered.">            while(rs.next()){</span>
<span class="fc" id="L91">            	ArrayList&lt;String&gt; course = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">            	for(int i = 1; i &lt; 4; i++){</span>
<span class="fc" id="L93">            		course.add(rs.getString(i));</span>
<span class="fc" id="L94">            	}courseList.add(new Course(course.get(0), course.get(1), course.get(2)));</span>
<span class="fc" id="L95">            }</span>
<span class="fc" id="L96">            conn.close();</span>
<span class="fc" id="L97">            return courseList;</span>
        }
<span class="nc" id="L99">        catch(SQLException e){</span>
<span class="nc" id="L100">        	System.out.println(e);</span>
<span class="nc" id="L101">            return null;</span>
        }	
    }
    
    /*
     * Database methods and queries for Lecture add-delete-update
     */
    
    // Add lecture
    public static void createLecture(Lecture lecture){
    	try{
<span class="fc" id="L112">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L113">            PreparedStatement stmt = conn.prepareStatement(&quot;INSERT INTO lecture (courseID, number, name) VALUES (?,?,?)&quot;);</span>
<span class="fc" id="L114">            stmt.setInt(1, Integer.parseInt(lecture.getCourseID()));</span>
<span class="fc" id="L115">            stmt.setInt(2, Integer.parseInt(lecture.getlectureNumber()));</span>
<span class="fc" id="L116">            stmt.setString(3, lecture.getlectureName());</span>
            
<span class="fc" id="L118">            stmt.executeUpdate();</span>
<span class="fc" id="L119">            conn.close();</span>
    	}
<span class="nc" id="L121">        catch(SQLException e){</span>
<span class="nc" id="L122">        	System.out.println(e);</span>
<span class="fc" id="L123">        }</span>
<span class="fc" id="L124">    }</span>
    
    // Edit lecture
    public static void editLecture(Lecture lecture){
    	try{
<span class="fc" id="L129">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
            //System.out.println((&quot;UPDATE lecture SET number = '&quot; + lecture.getlectureNumber() + &quot;', name = '&quot; + lecture.getlectureName() + &quot;' WHERE lectureID = &quot; + lecture.getLectureID()));
<span class="fc" id="L131">            PreparedStatement stmt = conn.prepareStatement(</span>
<span class="fc" id="L132">            		&quot;UPDATE lecture SET number = '&quot; + lecture.getlectureNumber() + &quot;', name = '&quot; + </span>
<span class="fc" id="L133">            		lecture.getlectureName() + &quot;' WHERE lectureID = &quot; + lecture.getLectureID());</span>
<span class="fc" id="L134">            stmt.executeUpdate();</span>
<span class="fc" id="L135">            conn.close();</span>
    	}
<span class="nc" id="L137">        catch(SQLException e){</span>
<span class="nc" id="L138">        	System.out.println(e);</span>
<span class="fc" id="L139">        }</span>
<span class="fc" id="L140">    }</span>
    
    // Delete lecture
    public static void deleteLecture(Lecture lecture){
    	try{
<span class="fc" id="L145">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L146">            PreparedStatement stmt = conn.prepareStatement(&quot;DELETE FROM lecture WHERE lectureID = ?&quot;);</span>
            //DELETE FROM 'prodoteam_db'.'lecture'WHERE 'lecture'.'lectureID' = 15
<span class="fc" id="L148">            stmt.setInt(1, Integer.parseInt(lecture.getLectureID()));</span>
            //
<span class="fc" id="L150">            stmt.executeUpdate();</span>
<span class="fc" id="L151">            conn.close();</span>
    	}
<span class="nc" id="L153">        catch(SQLException e){</span>
<span class="nc" id="L154">        	System.out.println(e);</span>
<span class="fc" id="L155">        }</span>
<span class="fc" id="L156">    }</span>
    
    /*
     * Database methods and queries for Topic add-delete-update
     */
    // Add topic
    public static void createTopic(Topic topic){
    	try{
<span class="fc" id="L164">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L165">            PreparedStatement stmt = conn.prepareStatement(&quot;INSERT INTO topic (lectureID, number, name) VALUES (?,?,?)&quot;);</span>
<span class="fc" id="L166">            stmt.setInt(1, Integer.parseInt(topic.getLectureID()));</span>
<span class="fc" id="L167">            stmt.setInt(2, Integer.parseInt(topic.getTopicNumber()));</span>
<span class="fc" id="L168">            stmt.setString(3, topic.getTopicName());</span>
            
<span class="fc" id="L170">            stmt.executeUpdate();</span>
<span class="fc" id="L171">            conn.close();</span>
    	}
<span class="nc" id="L173">        catch(SQLException e){</span>
<span class="nc" id="L174">        	System.out.println(e);</span>
<span class="fc" id="L175">        }</span>
<span class="fc" id="L176">    }</span>
    
    //Edit topic
    public static void editTopic(Topic topic){
    	try{
<span class="fc" id="L181">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L182">            PreparedStatement stmt = conn.prepareStatement(</span>
<span class="fc" id="L183">            		&quot;UPDATE topic SET number = '&quot; + topic.getTopicNumber() + &quot;', name = '&quot; + </span>
<span class="fc" id="L184">            		topic.getTopicName() + &quot;' WHERE topicID = &quot; + topic.getTopicID());</span>
<span class="fc" id="L185">            stmt.executeUpdate();</span>
<span class="fc" id="L186">            conn.close();</span>
    	}
<span class="nc" id="L188">        catch(SQLException e){</span>
<span class="nc" id="L189">        	System.out.println(e);</span>
<span class="fc" id="L190">        }</span>
<span class="fc" id="L191">    }</span>
    
    // Delete topic
    public static void deleteTopic(Topic topic){
    	try{
<span class="fc" id="L196">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L197">            PreparedStatement stmt = conn.prepareStatement(&quot;DELETE FROM topic WHERE topicID = ?&quot;);</span>
<span class="fc" id="L198">            stmt.setInt(1, Integer.parseInt(topic.getTopicID()));</span>
            
<span class="fc" id="L200">            stmt.executeUpdate();</span>
<span class="fc" id="L201">            conn.close();</span>
    	}
<span class="nc" id="L203">        catch(SQLException e){</span>
<span class="nc" id="L204">        	System.out.println(e);</span>
<span class="fc" id="L205">        }</span>
<span class="fc" id="L206">    }</span>
    
    
    // ------------QUESTION TAB------------
    /*
     * Display questions from students
     */
    // Finds all questions from a given topic (topicID)
        
    public static ObservableList&lt;Question&gt; Question(String topicID){
<span class="fc" id="L216">    	ObservableList&lt;Question&gt; questionList = FXCollections.observableArrayList();</span>
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">    	if(topicID == &quot;empty&quot;){</span>
<span class="nc" id="L218">    		return questionList;</span>
    	}
    	try{
<span class="fc" id="L221">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L222">           	PreparedStatement stmt = conn.prepareStatement(&quot;SELECT * FROM question WHERE topicID = &quot; + topicID);</span>
<span class="fc" id="L223">           	ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">           	while(rs.next()){</span>
<span class="fc" id="L225">            	ArrayList&lt;String&gt; question = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L226" title="All 2 branches covered.">            	for(int i = 1; i &lt; 6; i++){</span>
<span class="fc" id="L227">            		question.add(rs.getString(i));</span>
<span class="fc" id="L228">            	}questionList.add(new Question(question.get(0), question.get(1), question.get(2), question.get(3), question.get(4)));</span>
<span class="fc" id="L229">            }</span>
<span class="fc" id="L230">           	conn.close();</span>
<span class="fc" id="L231">            return questionList;</span>
        }
<span class="nc" id="L233">        catch(SQLException e){</span>
<span class="nc" id="L234">        	return null;</span>
        }
    }
    
    // Answer Question
    public static void answerQuestion(Question question, String answer){
    	try{
<span class="fc" id="L241">            Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L242">            PreparedStatement stmt = conn.prepareStatement(&quot;UPDATE question SET answer = '&quot; + answer + &quot;' WHERE questionID = &quot; + question.getQuestionID());</span>
<span class="fc" id="L243">            stmt.executeUpdate();</span>
<span class="fc" id="L244">            conn.close();</span>
    	}
<span class="nc" id="L246">        catch(SQLException e){</span>
<span class="nc" id="L247">        	System.out.println(e);</span>
<span class="fc" id="L248">        }</span>
<span class="fc" id="L249">    }</span>
    
    
    // ------------FEEDBACK TAB------------
    
    // Get average rating for all lectures in a given course
    public static ObservableList&lt;Rating&gt; lectureRating(String courseID){
<span class="fc" id="L256">    	ObservableList&lt;Rating&gt; ratingList = FXCollections.observableArrayList();    	</span>
<span class="pc bpc" id="L257" title="1 of 2 branches missed.">    	if(courseID == &quot;empty&quot;){</span>
<span class="nc" id="L258">    		return ratingList;</span>
    	}
<span class="fc" id="L260">    	String getRatings = &quot;SELECT table2.number, table2.name, ROUND(AVG(table2.stars),1) AS average, COUNT(table2.stars) AS votes &quot;</span>
    					  + &quot;FROM &quot;
    					  +		&quot;(SELECT lecture.number, lecture.lectureID, lecture.name, table1.topicID ,table1.stars &quot;
					   	  + 	&quot;FROM lecture &quot;
					      + 	&quot;RIGHT JOIN &quot;
					      +			&quot;(SELECT topic.lectureID, topic.topicID, rating.stars &quot;
					      +			&quot;FROM rating &quot;
					      +			&quot;RIGHT JOIN topic ON topic.topicID = rating.topicID &quot;
					      +			&quot;WHERE topic.lectureID IN &quot;
					      +				&quot;(SELECT lecture.lectureID &quot;
					      +				&quot;FROM lecture &quot;
					      +				&quot;INNER JOIN course ON course.courseID = lecture.courseID &quot;
					      +				&quot;WHERE lecture.courseID = &quot; + courseID
					      +     		&quot;) &quot;
					      +   		&quot;) table1 &quot;
					      + 	&quot;ON lecture.lectureID = table1.lectureID &quot;
					      +		&quot;) table2 &quot;
					      + &quot;GROUP BY table2.name &quot;
					      + &quot;ORDER BY table2.number ASC&quot;;
    	try{
<span class="fc" id="L280">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L281">    		PreparedStatement stmt = conn.prepareStatement(getRatings);</span>
<span class="fc" id="L282">           	ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">           	while(rs.next()){</span>
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">           		if(rs.getString(3) != null){</span>
<span class="nc" id="L285">           			ratingList.add(new Rating(rs.getString(1), rs.getString(2), rs.getString(3), rs.getString(4)));</span>
           		}else{
<span class="fc" id="L287">           			ratingList.add(new Rating(rs.getString(1), rs.getString(2), &quot;Not yet rated&quot;, rs.getString(4)));</span>
           		}
            }
<span class="fc" id="L290">           	conn.close();</span>
<span class="fc" id="L291">            return ratingList;</span>
        }
<span class="nc" id="L293">        catch(SQLException e){</span>
<span class="nc" id="L294">        	System.out.println(e);</span>
<span class="nc" id="L295">        	return null;</span>
        }
    }
    
    // Get average and total votes on a given course
    public static ArrayList&lt;String&gt; courseAvgRating(String courseID){
<span class="fc" id="L301">    	ArrayList&lt;String&gt; rating = new ArrayList&lt;String&gt;();</span>
    	// Statement in one line:
    	// &quot;SELECT AVG(rating.stars) AS average, COUNT(rating.stars) AS votes FROM rating INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON lecture.lectureID = topic.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID &quot;
<span class="fc" id="L304">    	String statement = &quot;SELECT AVG(rating.stars) AS average, COUNT(rating.stars) AS votes &quot;</span>
    					 + &quot;FROM rating &quot;
    					 + &quot;INNER JOIN (SELECT topic.topicID &quot;
    					 +		&quot;FROM topic &quot;
    					 +		&quot;INNER JOIN lecture ON lecture.lectureID = topic.lectureID &quot;
    					 +		&quot;WHERE lecture.courseID = &quot; + courseID + &quot;) table1 &quot;
    					 + &quot;ON rating.topicID = table1.topicID &quot;;
    	try{
<span class="fc" id="L312">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L313">    		PreparedStatement stmt = conn.prepareStatement(statement);</span>
<span class="fc" id="L314">           	ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L315" title="All 2 branches covered.">           	while(rs.next()){</span>
<span class="fc" id="L316">           		rating.add(rs.getString(1));</span>
<span class="fc" id="L317">           		rating.add(rs.getString(2));</span>
            }
<span class="fc" id="L319">           	conn.close();</span>
<span class="fc" id="L320">            return rating;</span>
        }
<span class="nc" id="L322">        catch(SQLException e){</span>
<span class="nc" id="L323">        	System.out.println(e);</span>
<span class="nc" id="L324">        	return null;</span>
        }
    }
    
    // Get average rating for all topics in a given lecture
    public static ObservableList&lt;Rating&gt; topicRating(String lectureID){
<span class="fc" id="L330">    	ObservableList&lt;Rating&gt; ratingList = FXCollections.observableArrayList();    	</span>
    	// Statement in one line:
    	// &quot;SELECT table1.number, table1.name, ROUND(AVG(table1.stars),1) AS average, COUNT(table1.stars) as votes FROM (SELECT topic.number, topic.name, rating.stars FROM rating RIGHT JOIN topic ON topic.topicID = rating.topicID WHERE topic.lectureID = &quot; + lectureID + &quot;) table1 GROUP BY table1.name ORDER BY table1.number ASC&quot;
<span class="fc" id="L333">    	String getRatings = &quot;SELECT table1.number, table1.name, ROUND(AVG(table1.stars),1) AS average, COUNT(table1.stars) as votes &quot;</span>
    					  + &quot;FROM &quot;
    					  + 	&quot;(SELECT topic.number, topic.name, rating.stars &quot;
    					  +		&quot;FROM rating &quot;
    					  +		&quot;RIGHT JOIN topic ON topic.topicID = rating.topicID &quot;
    					  +		&quot;WHERE topic.lectureID = &quot; + lectureID + &quot;) table1 &quot;
    					  + &quot;GROUP BY table1.name &quot;
    					  + &quot;ORDER BY table1.number ASC&quot;;
    	try{
<span class="fc" id="L342">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L343">    		PreparedStatement stmt = conn.prepareStatement(getRatings);</span>
<span class="fc" id="L344">           	ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L345" title="All 2 branches covered.">           	while(rs.next()){</span>
<span class="pc bpc" id="L346" title="1 of 2 branches missed.">           		if(rs.getString(3) != null){</span>
<span class="nc" id="L347">           			ratingList.add(new Rating(rs.getString(1), rs.getString(2), rs.getString(3), rs.getString(4)));</span>
           		}else{
<span class="fc" id="L349">           			ratingList.add(new Rating(rs.getString(1), rs.getString(2), &quot;Not yet rated&quot;, rs.getString(4)));</span>
           		}
            }
<span class="fc" id="L352">           	conn.close();</span>
<span class="fc" id="L353">            return ratingList;</span>
        }
<span class="nc" id="L355">        catch(SQLException e){</span>
<span class="nc" id="L356">        	System.out.println(e);</span>
<span class="nc" id="L357">        	return null;</span>
        }
    }
    
    // Get average and total votes on a given course
    public static ArrayList&lt;String&gt; lectureAvgRating(String lectureID){
<span class="fc" id="L363">    	ArrayList&lt;String&gt; rating = new ArrayList&lt;String&gt;();</span>
    	// Statement in one line:
    	// &quot;SELECT AVG(rating.stars) AS average, COUNT(rating.stars) AS votes FROM rating INNER JOIN topic ON rating.topicID = topic.topicID WHERE topic.lectureID = &quot; + lectureID;
<span class="fc" id="L366">    	String statement = &quot;SELECT AVG(rating.stars) AS average, COUNT(rating.stars) AS votes &quot;</span>
    					 + &quot;FROM rating &quot;
    					 + &quot;INNER JOIN topic ON rating.topicID = topic.topicID &quot;
    					 + &quot;WHERE topic.lectureID = &quot; + lectureID;
    	try{
<span class="fc" id="L371">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L372">    		PreparedStatement stmt = conn.prepareStatement(statement);</span>
<span class="fc" id="L373">           	ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L374" title="All 2 branches covered.">           	while(rs.next()){</span>
<span class="fc" id="L375">           		rating.add(rs.getString(1));</span>
<span class="fc" id="L376">           		rating.add(rs.getString(2));</span>
            }
<span class="fc" id="L378">           	conn.close();</span>
<span class="fc" id="L379">            return rating;</span>
        }
<span class="nc" id="L381">        catch(SQLException e){</span>
<span class="nc" id="L382">        	System.out.println(e);</span>
<span class="nc" id="L383">        	return null;</span>
        }
    }
    
    
    // ------------STATISTICS TAB------------
    
    // Get topics with average rating less than 3
    public static ObservableList&lt;Rating&gt; badTopics(String courseID){
<span class="fc" id="L392">    	ObservableList&lt;Rating&gt; ratingList = FXCollections.observableArrayList();</span>
<span class="pc bpc" id="L393" title="1 of 2 branches missed.">    	if(courseID == &quot;empty&quot;){</span>
<span class="nc" id="L394">    		return ratingList;</span>
    	}
    	// Statement in one line:
    	// &quot;SELECT * FROM (SELECT lecture.number lectureNumber, lecture.name lectureName, table1.number topicNumber, table1.name topicName, ROUND(AVG(table1.stars),1) average, COUNT(table1.stars) votes FROM lecture RIGHT JOIN (SELECT topic.lectureID, topic.name, topic.topicID, topic.number, rating.stars FROM rating RIGHT JOIN topic ON topic.topicID = rating.topicID WHERE topic.lectureID IN (SELECT lecture.lectureID FROM lecture INNER JOIN course ON course.courseID = lecture.courseID WHERE lecture.courseID = &quot; + courseID + &quot;) ) table1 ON lecture.lectureID = table1.lectureID GROUP BY topicID ) table2 WHERE table2.average &lt;= 3 ORDER BY lectureNumber, topicNumber ASC&quot;
<span class="fc" id="L398">    	String statement = &quot;SELECT * &quot;</span>
    					 + &quot;FROM &quot;
    					 + 		&quot;(SELECT lecture.number lectureNumber, lecture.name lectureName, table1.number topicNumber, table1.name topicName, ROUND(AVG(table1.stars),1) average, COUNT(table1.stars) votes &quot;
    					 + 		&quot;FROM lecture &quot;
    					 + 		&quot;RIGHT JOIN &quot;
    					 + 			&quot;(SELECT topic.lectureID, topic.name, topic.topicID, topic.number, rating.stars &quot;
    					 + 			&quot;FROM rating &quot;
    					 + 			&quot;RIGHT JOIN topic ON topic.topicID = rating.topicID &quot;
    					 + 			&quot;WHERE topic.lectureID IN &quot;
    					 + 				&quot;(SELECT lecture.lectureID &quot;
    					 + 				&quot;FROM lecture &quot;
    					 + 				&quot;INNER JOIN course ON course.courseID = lecture.courseID &quot;
    					 + 				&quot;WHERE lecture.courseID = &quot; + courseID + &quot;) &quot;
    					 + 			&quot;) table1 &quot;
    					 + 			&quot;ON lecture.lectureID = table1.lectureID &quot;
    					 + 			&quot;GROUP BY topicID &quot;
    					 + 		&quot;) table2 &quot;
    					 + 		&quot;WHERE table2.average &lt; 3 &quot;
    					 + 		&quot;ORDER BY lectureNumber, topicNumber ASC&quot;;
    	try{
<span class="fc" id="L418">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
<span class="fc" id="L419">    		PreparedStatement stmt = conn.prepareStatement(statement);</span>
<span class="fc" id="L420">    		ResultSet rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L421" title="1 of 2 branches missed.">    		while(rs.next()){</span>
<span class="nc" id="L422">           		ratingList.add(new Rating(rs.getString(2), rs.getString(4), rs.getString(5), rs.getString(6)));</span>
            }
<span class="fc" id="L424">           	conn.close();</span>
<span class="fc" id="L425">            return ratingList;</span>
        }
<span class="nc" id="L427">        catch(SQLException e){</span>
<span class="nc" id="L428">        	System.out.println(e);</span>
<span class="nc" id="L429">        	return null;</span>
        }
    }
    
 // Get topics with average rating less than 3
    public static ArrayList&lt;String&gt; getStats(String courseID){
<span class="fc" id="L435">    	ArrayList&lt;String&gt; stats = new ArrayList&lt;String&gt;();</span>
    	try{
<span class="fc" id="L437">    		Connection conn = DriverManager.getConnection(mysqlAddr, mysqlUser, mysqlPass);</span>
    		
    		// Get total number of lectures
<span class="fc" id="L440">    		PreparedStatement stmt = conn.prepareStatement(&quot;SELECT COUNT(lecture.lectureID) FROM lecture WHERE lecture.courseID = &quot; + courseID);</span>
<span class="fc" id="L441">    		ResultSet rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L442" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L443">           		stats.add(rs.getString(1));</span>
            }
           	
            // Get total number of topics
<span class="fc" id="L447">            stmt = conn.prepareStatement(&quot;SELECT COUNT(topic.topicID) FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID);</span>
<span class="fc" id="L448">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L449" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L450">           		stats.add(rs.getString(1));</span>
            }
            
            // Get total number of questions
<span class="fc" id="L454">            stmt = conn.prepareStatement(&quot;SELECT COUNT(question.questionID) FROM question INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON question.topicID = table1.topicID&quot;);</span>
<span class="fc" id="L455">    		rs = stmt.executeQuery();</span>
<span class="fc" id="L456">    		Double tQ = 0.0;</span>
<span class="pc bpc" id="L457" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L458">           		tQ = Double.parseDouble(rs.getString(1));</span>
<span class="fc" id="L459">    			stats.add(rs.getString(1));</span>
            }
            
            // Get total number of answered questions
<span class="fc" id="L463">            stmt = conn.prepareStatement(&quot;SELECT COUNT(question.questionID) FROM question INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON question.topicID = table1.topicID WHERE question.answer IS NOT null&quot;);</span>
<span class="fc" id="L464">    		rs = stmt.executeQuery();</span>
<span class="fc" id="L465">    		Double aQ = 0.0;</span>
<span class="pc bpc" id="L466" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L467">    			aQ = Double.parseDouble(rs.getString(1));</span>
<span class="fc" id="L468">           		stats.add(rs.getString(1));</span>
            }
            
            // Get total number of unanswered questions
<span class="fc" id="L472">            stmt = conn.prepareStatement(&quot;SELECT COUNT(question.questionID) FROM question INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON question.topicID = table1.topicID WHERE question.answer IS null&quot;);</span>
<span class="fc" id="L473">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L474" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L475">           		stats.add(rs.getString(1));</span>
            }
            
            // Get percentage of questions answered
<span class="pc bpc" id="L479" title="1 of 2 branches missed.">            if(tQ != 0){</span>
<span class="nc" id="L480">            	Double percentage = aQ/tQ*100;</span>
<span class="nc" id="L481">            	String percentageString = percentage + &quot;%&quot;;</span>
<span class="nc" id="L482">            	stats.add(percentageString);</span>
<span class="nc" id="L483">            }else{</span>
<span class="fc" id="L484">            	stats.add(&quot;No questions registered in this course yet&quot;);</span>
            }
            
            // Get number of votes/ratings
<span class="fc" id="L488">            stmt = conn.prepareStatement(&quot;SELECT COUNT(rating.ratingID) FROM rating INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID&quot;);</span>
<span class="fc" id="L489">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L490" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L491">           		stats.add(rs.getString(1));</span>
            }
            
            // Get number of topics with an average rating of 5
<span class="fc" id="L495">            stmt = conn.prepareStatement(&quot;SELECT COUNT(table2.average) FROM ( SELECT AVG(rating.stars) average FROM rating INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID GROUP BY rating.topicID) table2 WHERE table2.average = 5&quot;);</span>
<span class="fc" id="L496">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L497" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L498">           		stats.add(rs.getString(1));</span>
            }
            
            // Get number of topics with an average rating below 3
<span class="fc" id="L502">            stmt = conn.prepareStatement(&quot;SELECT COUNT(table2.average) FROM ( SELECT AVG(rating.stars) average FROM rating INNER JOIN (SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID GROUP BY rating.topicID) table2 WHERE table2.average &lt; 3&quot;);</span>
<span class="fc" id="L503">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L504" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L505">           		stats.add(rs.getString(1));</span>
            }
            
            // Get number of unrated topics
<span class="fc" id="L509">            stmt = conn.prepareStatement(&quot;SELECT COUNT(table2.topicID) FROM (SELECT table1.topicID, rating.stars FROM rating RIGHT JOIN ( SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID) table2 WHERE table2.stars IS null&quot;);</span>
<span class="fc" id="L510">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L511" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L512">           		stats.add(rs.getString(1));</span>
            }
            
            // Get topic with the most votes/ratings
            // This statement can probably be made a lot cleaner and shorter, but this is the only way I got it to work -Jonas
<span class="fc" id="L517">            stmt = conn.prepareStatement(&quot;SELECT table2.lectureNumber, table2.topicName, table2.votes FROM ( SELECT table1.lectureNumber, table1.topicName, COUNT(rating.stars) votes FROM rating RIGHT JOIN ( SELECT lecture.number lectureNumber, topic.topicID, topic.name topicName FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID GROUP BY table1.topicID) table2 WHERE table2.votes IN ( SELECT MAX(table4.votes) maximum FROM ( SELECT COUNT(rating.stars) votes FROM rating RIGHT JOIN ( SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table3 ON rating.topicID = table3.topicID GROUP BY table3.topicID) table4 )&quot;);</span>
<span class="fc" id="L518">    		rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L519" title="1 of 2 branches missed.">    		if(rs.next()){</span>
<span class="fc" id="L520">    			String fullString = &quot;&quot;;</span>
<span class="pc bpc" id="L521" title="1 of 2 branches missed.">    			if(rs.getString(3).equals(&quot;1&quot;)){</span>
<span class="nc" id="L522">    				fullString = rs.getString(3) + &quot; vote on '&quot; + rs.getString(2) + &quot;' from lecture &quot; + rs.getString(1);</span>
    			}else{
<span class="fc" id="L524">    				fullString = rs.getString(3) + &quot; votes on '&quot; + rs.getString(2) + &quot;' from lecture &quot; + rs.getString(1);</span>
    			}
<span class="fc" id="L526">    			stats.add(fullString);</span>
<span class="fc" id="L527">            }else{</span>
<span class="nc" id="L528">            	stats.add(&quot;No ratings registered in this course yet&quot;);</span>
            }
                		
            // Get topic(s) with the best rating
    		// Same as last statement; can probably be done better
<span class="fc" id="L533">            stmt = conn.prepareStatement(&quot;SELECT table2.topicName, table2.average FROM (SELECT table1.topicName, ROUND(AVG(rating.stars), 1) average FROM rating RIGHT JOIN ( SELECT topic.topicID, topic.name topicName FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID GROUP BY table1.topicID) table2 WHERE table2.average IN (SELECT MAX(average) FROM (SELECT ROUND(AVG(rating.stars), 1) average FROM rating RIGHT JOIN ( SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table3 ON rating.topicID = table3.topicID GROUP BY table3.topicID) table4)&quot;);</span>
<span class="fc" id="L534">    		rs = stmt.executeQuery();</span>
<span class="fc" id="L535">    		String fullString = &quot;&quot;;</span>
<span class="fc" id="L536">    		String rating = &quot;&quot;;</span>
<span class="pc bpc" id="L537" title="1 of 2 branches missed.">    		while(rs.next()){</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">    			if(fullString == &quot;&quot;){</span>
<span class="nc" id="L539">    				fullString = &quot;'&quot; + rs.getString(1) + &quot;'&quot;;</span>
<span class="nc" id="L540">    				rating = rs.getString(2);</span>
    			}else{
<span class="nc" id="L542">    				fullString += &quot;, '&quot; + rs.getString(1) + &quot;'&quot;;</span>
    			}
    		}
<span class="pc bpc" id="L545" title="1 of 2 branches missed.">    		if(fullString == &quot;&quot;){</span>
<span class="fc" id="L546">    			fullString = &quot;No ratings registered in this course yet&quot;;</span>
    		}else{
<span class="nc" id="L548">    			fullString += &quot; with rating &quot; + rating;</span>
    		}
<span class="fc" id="L550">    		stats.add(fullString);</span>
            
            // Get topic(s) with the worst rating
    		// Same as last statement; can probably be done better
<span class="fc" id="L554">            stmt = conn.prepareStatement(&quot;SELECT table2.topicName, table2.average FROM (SELECT table1.topicName, ROUND(AVG(rating.stars), 1) average FROM rating RIGHT JOIN ( SELECT topic.topicID, topic.name topicName FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table1 ON rating.topicID = table1.topicID GROUP BY table1.topicID) table2 WHERE table2.average IN (SELECT MIN(average) FROM (SELECT ROUND(AVG(rating.stars), 1) average FROM rating RIGHT JOIN ( SELECT topic.topicID FROM topic INNER JOIN lecture ON topic.lectureID = lecture.lectureID WHERE lecture.courseID = &quot; + courseID + &quot;) table3 ON rating.topicID = table3.topicID GROUP BY table3.topicID) table4)&quot;);</span>
<span class="fc" id="L555">    		rs = stmt.executeQuery();</span>
<span class="fc" id="L556">    		fullString = &quot;&quot;;</span>
<span class="fc" id="L557">    		rating = &quot;&quot;;</span>
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">    		while(rs.next()){</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">    			if(fullString == &quot;&quot;){</span>
<span class="nc" id="L560">    				fullString = &quot;'&quot; + rs.getString(1) + &quot;'&quot;;</span>
<span class="nc" id="L561">    				rating = rs.getString(2);</span>
    			}else{
<span class="nc" id="L563">    				fullString += &quot;, '&quot; + rs.getString(1) + &quot;'&quot;;</span>
    			}
    		}
<span class="pc bpc" id="L566" title="1 of 2 branches missed.">    		if(fullString == &quot;&quot;){</span>
<span class="fc" id="L567">    			fullString = &quot;No ratings registered in this course yet&quot;;</span>
    		}else{
<span class="nc" id="L569">    			fullString += &quot; with rating &quot; + rating;</span>
    		}
<span class="fc" id="L571">    		stats.add(fullString);</span>
    		
<span class="fc" id="L573">            conn.close();</span>
<span class="fc" id="L574">            return stats;</span>
        }
<span class="nc" id="L576">        catch(SQLException e){</span>
<span class="nc" id="L577">        	System.out.println(e);</span>
<span class="nc" id="L578">        	return null;</span>
        }
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>